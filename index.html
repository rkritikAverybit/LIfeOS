<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LifeOS Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
      /* ... (Same CSS as before - no changes needed) ... */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        display: flex;
        background: #f5f7fa;
      }

      .sidebar {
        width: 250px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        height: 100vh;
        position: fixed;
      }

      .sidebar h2 {
        margin-bottom: 30px;
        font-size: 24px;
      }

      .sidebar ul {
        list-style: none;
      }

      .sidebar li {
        margin: 15px 0;
      }

      .sidebar a {
        color: white;
        text-decoration: none;
        font-size: 16px;
        display: block;
        padding: 10px;
        border-radius: 8px;
        transition: background 0.3s;
      }

      .sidebar a:hover,
      .sidebar a.active {
        background: rgba(255, 255, 255, 0.2);
      }

      #app {
        margin-left: 250px;
        padding: 40px;
        width: calc(100% - 250px);
        min-height: 100vh;
      }

      .loading {
        text-align: center;
        padding: 50px;
        color: #999;
        font-size: 18px;
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 32px;
        color: #333;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      button:hover {
        background: #5568d3;
      }

      input,
      textarea {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
      }

      .card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .event-card {
        display: flex;
        gap: 20px;
        align-items: start;
      }

      .event-card .time {
        font-weight: bold;
        color: #667eea;
        font-size: 18px;
        min-width: 80px;
      }

      .habit-card {
        border-left: 4px solid #51cf66;
      }

      .habit-card h3 {
        margin-bottom: 8px;
        color: #333;
      }

      .streak {
        margin: 10px 0;
        color: #ff6b6b;
        font-weight: bold;
        font-size: 16px;
      }

      .habit-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .btn-done {
        background: #51cf66;
        flex: 1;
      }

      .btn-skip {
        background: #ff6b6b;
        flex: 1;
      }

      .finance-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
      }

      .stat-card h3 {
        font-size: 14px;
        margin-bottom: 10px;
        opacity: 0.9;
      }

      .stat-card .amount {
        font-size: 28px;
        font-weight: bold;
      }

      .wellness-form {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
      }

      .mood-selector {
        display: flex;
        gap: 10px;
        justify-content: space-between;
      }

      .mood-btn {
        flex: 1;
        padding: 15px;
        font-size: 24px;
        background: white;
        border: 2px solid #ddd;
        cursor: pointer;
        border-radius: 8px;
      }

      .mood-btn.selected {
        background: #667eea;
        border-color: #667eea;
      }

      .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #51cf66;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        animation: slideIn 0.3s ease;
        z-index: 1000;
      }

/* File Upload Styles */
.file-upload-container {
    border: 2px dashed #667eea;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    background: #f8f9ff;
    cursor: pointer;
    transition: all 0.3s ease;
}

.file-upload-container:hover {
    border-color: #5568d3;
    background: #f0f4ff;
}

.file-upload-container.drag-over {
    border-color: #51cf66;
    background: #e7f5ff;
    transform: scale(1.02);
}

.upload-icon {
    font-size: 48px;
    margin-bottom: 15px;
}

.file-upload-container h3 {
    margin: 0 0 8px 0;
    color: #333;
}

.file-upload-container p {
    color: #666;
    font-size: 14px;
    margin: 0;
}

.upload-status {
    margin-top: 20px;
    padding: 15px;
    border-radius: 8px;
    display: none;
}

.upload-status.success {
    display: block;
    background: #d3f9d8;
    color: #2b8a3e;
    border: 1px solid #51cf66;
}

.upload-status.error {
    display: block;
    background: #ffe3e3;
    color: #c92a2a;
    border: 1px solid #ff6b6b;
}

.categorized-preview {
    margin-top: 20px;
    max-height: 300px;
    overflow-y: auto;
}

.preview-item {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    border-bottom: 1px solid #eee;
    font-size: 14px;
}

.preview-item:last-child {
    border-bottom: none;
}

/* Summary Grid */
.summary-grid {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.category-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.category-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.category-name {
    font-weight: 500;
    color: #333;
}

.category-percentage {
    font-size: 13px;
    color: #666;
}

.category-bar {
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.category-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.3s ease;
}

.category-amount {
    font-weight: 600;
    color: #667eea;
    font-size: 16px;
}

/* Merchants List */
.merchants-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.merchant-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.merchant-name {
    font-weight: 500;
    color: #333;
}

.merchant-amount {
    font-weight: 600;
    color: #667eea;
}

/* Budget Variance */
.variance-indicator {
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    font-size: 16px;
    font-weight: 500;
}

.variance-indicator.over-budget {
    background: #ffe3e3;
    color: #c92a2a;
    border: 2px solid #ff6b6b;
}

.variance-indicator.under-budget {
    background: #d3f9d8;
    color: #2b8a3e;
    border: 2px solid #51cf66;
}

/* Alert Configuration */
.alert-config {
    margin-bottom: 25px;
}

.alert-config label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #333;
}

/* Large Transactions */
.large-transactions-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 20px;
}

.alert-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #fff5f5;
    border: 1px solid #ff6b6b;
    border-radius: 8px;
}

.alert-icon {
    font-size: 24px;
    flex-shrink: 0;
}

.alert-details {
    flex: 1;
}

.alert-details strong {
    color: #333;
    display: block;
}

.alert-amount {
    font-size: 18px;
    font-weight: 700;
    color: #ff6b6b;
}
/* Wellness Trend Section */
.wellness-trend-section {
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.trend-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
}

.trend-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.trend-icon {
    font-size: 36px;
    flex-shrink: 0;
}

.trend-info {
    flex: 1;
}

.trend-label {
    font-size: 12px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.trend-value {
    font-size: 24px;
    font-weight: bold;
    color: #333;
    margin: 5px 0;
}

.trend-change {
    font-size: 13px;
    font-weight: 600;
    display: inline-block;
    padding: 3px 8px;
    border-radius: 12px;
}

.trend-change.positive {
    background: #d3f9d8;
    color: #2b8a3e;
}

.trend-change.negative {
    background: #ffe3e3;
    color: #c92a2a;
}

/* Charts Container */
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.chart-wrapper {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.chart-wrapper h3 {
    margin: 0 0 15px 0;
    font-size: 16px;
    color: #333;
}

.chart-wrapper canvas {
    max-height: 250px;
}

/* Wellness Suggestions */
.wellness-suggestions {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.wellness-suggestions h3 {
    margin: 0 0 20px 0;
    font-size: 18px;
    color: #333;
}

.suggestions-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.suggestion-item {
    display: flex;
    align-items: start;
    gap: 12px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.suggestion-icon {
    font-size: 20px;
    flex-shrink: 0;
}

.suggestion-item p {
    margin: 0;
    color: #555;
    line-height: 1.6;
    font-size: 14px;
}

/* Sheet Link */
.sheet-link {
    display: inline-block;
    padding: 12px 24px;
    background: #667eea;
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
}

.sheet-link:hover {
    background: #5568d3;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

/* Wellness Form Update */
.wellness-form {
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-top: 20px;
}

.wellness-form h2 {
    margin: 0 0 8px 0;
}



      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
      }
      /* Chat Container Styles */
      .chat-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        max-width: 800px;
      }

      .chat-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
      }

      .chat-header h3 {
        margin: 0;
        font-size: 18px;
      }

      .chat-messages {
        height: 400px;
        overflow-y: auto;
        padding: 20px;
        background: #f8f9fa;
        scroll-behavior: smooth;
      }

      .bot-message,
      .user-message {
        display: flex;
        margin-bottom: 15px;
        animation: slideUp 0.3s ease;
      }

      /* Prompt Card Styles */
      .prompt-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        padding: 30px;
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .prompt-header h3 {
        margin: 0 0 8px 0;
        font-size: 20px;
      }

      .hint-text {
        font-size: 13px;
        opacity: 0.9;
        margin: 0;
        line-height: 1.6;
      }

      .prompt-input-group {
        margin-top: 20px;
        display: flex;
        gap: 12px;
      }

      .prompt-input {
        flex: 1;
        padding: 16px 20px;
        border: none;
        border-radius: 25px;
        font-size: 15px;
        background: white;
        color: #333;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .prompt-input:focus {
        outline: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .prompt-input::placeholder {
        color: #999;
      }

      .prompt-btn {
        padding: 16px 32px;
        background: white;
        color: #667eea;
        border: none;
        border-radius: 25px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        white-space: nowrap;
      }

      .prompt-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .prompt-btn:active {
        transform: translateY(0);
      }

      /* Response Area */
      .prompt-response {
        margin-top: 20px;
        padding: 0;
        min-height: 0;
        transition: all 0.3s ease;
      }

      .prompt-response.show {
        padding: 20px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        backdrop-filter: blur(10px);
      }

      .response-content {
        display: flex;
        align-items: start;
        gap: 12px;
      }

      .response-icon {
        font-size: 24px;
        flex-shrink: 0;
      }

      .response-text {
        flex: 1;
      }

      .response-text h4 {
        margin: 0 0 8px 0;
        font-size: 16px;
      }

      .response-text p {
        margin: 4px 0;
        font-size: 14px;
        opacity: 0.95;
      }

      .response-text small {
        font-size: 12px;
        opacity: 0.8;
      }

      /* Success/Error States */
      .response-success {
        color: #51cf66;
      }

      .response-error {
        color: #ff6b6b;
      }

      /* Delete Button */
      .delete-btn {
        background: transparent;
        border: 1px solid #ff6b6b;
        color: #ff6b6b;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      .delete-btn:hover {
        background: #ff6b6b;
        color: white;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .prompt-input-group {
          flex-direction: column;
        }

        .prompt-btn {
          width: 100%;
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-message {
        justify-content: flex-end;
      }

      .message-bubble {
        max-width: 70%;
        padding: 12px 16px;
        border-radius: 18px;
        font-size: 14px;
        line-height: 1.5;
      }

      .message-bubble.bot {
        background: white;
        color: #333;
        border-bottom-left-radius: 4px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .message-bubble.user {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-bottom-right-radius: 4px;
      }

      .typing-indicator {
        display: flex;
        gap: 5px;
        padding: 15px;
      }

      .typing-indicator span {
        width: 8px;
        height: 8px;
        background: #999;
        border-radius: 50%;
        animation: typing 1.4s infinite;
      }

      .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        60%,
        100% {
          transform: translateY(0);
        }
        30% {
          transform: translateY(-10px);
        }
      }

      .chat-input-container {
        display: flex;
        padding: 15px;
        background: white;
        border-top: 1px solid #eee;
        gap: 10px;
      }

      .chat-input-container input {
        flex: 1;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 25px;
        font-size: 14px;
        margin: 0;
      }

      .chat-input-container button {
        padding: 12px 30px;
        border-radius: 25px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .event-suggestion {
        background: #f0f4ff;
        padding: 12px;
        border-radius: 8px;
        margin-top: 10px;
        border-left: 3px solid #667eea;
      }

      .event-suggestion strong {
        color: #667eea;
        display: block;
        margin-bottom: 5px;
      }

      .action-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
      }

      .action-buttons button {
        padding: 6px 12px;
        font-size: 12px;
        border-radius: 15px;
      }

      @media (max-width: 768px) {
        .sidebar {
          width: 60px;
        }

        .sidebar h2,
        .sidebar a span {
          display: none;
        }

        #app {
          margin-left: 60px;
          width: calc(100% - 60px);
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Sidebar Navigation - HASH ROUTING -->
    <nav class="sidebar">
      <h2>LifeOS</h2>
      <ul>
        <li>
          <a href="#/" data-link>üìä <span>Dashboard</span></a>
        </li>
        <li>
          <a href="#/schedule" data-link>üìÖ <span>Schedule</span></a>
        </li>
        <li>
          <a href="#/habits" data-link>‚úÖ <span>Habits</span></a>
        </li>
        <li>
          <a href="#/finance" data-link>üí∞ <span>Finance</span></a>
        </li>
        <li>
          <a href="#/wellness" data-link>üßò <span>Wellness</span></a>
        </li>
      </ul>
    </nav>

    <!-- Main Content Area -->
    <main id="app">
      <div class="loading">Loading...</div>
    </main>

    <!-- Event Creation Modal -->
    <div id="eventModal" class="modal">
      <div class="modal-content">
        <h2>Create Event</h2>
        <input type="text" id="eventTitle" placeholder="Event title" />
        <input type="datetime-local" id="eventTime" />
        <textarea
          id="eventDescription"
          placeholder="Description (optional)"
        ></textarea>
        <button onclick="createEvent()">Create Event</button>
        <button onclick="closeModal()" style="background: #999">Cancel</button>
      </div>
    </div>

    <script>
      // ============ n8n Configuration ============
      const N8N_BASE_URL = "https://your-n8n-instance.app.n8n.cloud/webhook";

      // ============ API Functions ============
      const API = {
        async getWellnessTrend() {
            try {
                const response = await fetch(`${N8N_BASE_URL}/wellness/trend`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ weeks: 4 })
                });
                return await response.json();
            } catch (error) {
                // Demo data for testing
                return {
                    avg_mood: 3.8,
                    mood_change: 12.5,
                    avg_sleep: 7.2,
                    sleep_change: -5.3,
                    avg_steps: 8500,
                    steps_change: 8.2,
                    checkin_count: 22,
                    weekly_data: [
                        { week: 'Week 1', mood: 3.5, sleep: 7.5, steps: 7800 },
                        { week: 'Week 2', mood: 3.7, sleep: 7.0, steps: 8200 },
                        { week: 'Week 3', mood: 3.9, sleep: 7.2, steps: 8800 },
                        { week: 'Week 4', mood: 4.1, sleep: 7.1, steps: 9200 }
                    ],
                    suggestions: [
                        { icon: 'üéØ', text: 'Your mood has improved by 12.5% this month! Keep up the positive habits.' },
                        { icon: 'üò¥', text: 'Sleep decreased slightly. Try maintaining a consistent bedtime routine.' },
                        { icon: 'üö∂', text: 'Great progress on steps! You\'re 8% more active than last month.' },
                        { icon: 'üìù', text: 'You logged 22 check-ins this month. Consistency is key to tracking wellness!' }
                    ],
                    sheet_link: 'https://docs.google.com/spreadsheets/d/your-sheet-id/edit'
                };
            }
        },

        async logWellness(data) {
            const response = await fetch(`${N8N_BASE_URL}/wellness/log`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            return await response.json();
        },
        async uploadCSV(file) {
          const formData = new FormData();
          formData.append("file", file);

          const response = await fetch(`${N8N_BASE_URL}/finance/csv-upload`, {
            method: "POST",
            body: formData,
          });
          return await response.json();
        },

        async getFinanceSummary(month) {
          try {
            const response = await fetch(`${N8N_BASE_URL}/finance/summary`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ month }),
            });
            return await response.json();
          } catch (error) {
            // Demo data with all sections
            return {
              total_income: 80000,
              total_expense: 55000,
              balance: 25000,
              alert_threshold: 10000,
              categories: {
                Housing: 20000,
                "Food & Dining": 12000,
                Transportation: 8000,
                Shopping: 7000,
                Entertainment: 5000,
                Utilities: 3000,
              },
              top_merchants: [
                { name: "Amazon", amount: 15000 },
                { name: "Swiggy", amount: 8000 },
                { name: "Zomato", amount: 4000 },
              ],
              budget_variance: -5000,
              large_transactions: [
                {
                  description: "Laptop Purchase",
                  amount: 65000,
                  date: "2025-10-20",
                  category: "Shopping",
                },
                {
                  description: "Flight Booking",
                  amount: 25000,
                  date: "2025-10-15",
                  category: "Travel",
                },
                {
                  description: "Medical Bill",
                  amount: 18000,
                  date: "2025-10-10",
                  category: "Healthcare",
                },
              ],
            };
          }
        },

        async updateAlertThreshold(threshold) {
          const response = await fetch(
            `${N8N_BASE_URL}/finance/alert-threshold`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ threshold }),
            }
          );
          return await response.json();
        },

        async getSchedule(date) {
          try {
            // Demo data for testing without n8n
            return {
              events: [
                {
                  title: "Team Meeting",
                  start_time: "2025-10-24T10:00:00",
                  description: "Weekly sync",
                },
                {
                  title: "Lunch Break",
                  start_time: "2025-10-24T13:00:00",
                  description: "Break time",
                },
              ],
            };
          } catch (error) {
            console.error("Error:", error);
            return { events: [] };
          }
        },

        async createEvent(eventData) {
          console.log("Creating event:", eventData);
          return { success: true };
        },

        async getHabits() {
          try {
            // Demo data
            return [
              { id: "1", name: "Meditation", target_count: 5, streak: 3 },
              { id: "2", name: "Exercise", target_count: 4, streak: 7 },
              { id: "3", name: "Reading", target_count: 7, streak: 2 },
            ];
          } catch (error) {
            return [];
          }
        },

        async logHabit(habitId, status) {
          console.log("Logging habit:", habitId, status);
          return { success: true };
        },

        async getFinanceSummary(month) {
          try {
            // Demo data
            return {
              total_income: 50000,
              total_expense: 35000,
              balance: 15000,
              transactions: [
                {
                  description: "Salary",
                  category: "Income",
                  amount: 50000,
                  type: "income",
                  date: "2025-10-01",
                },
                {
                  description: "Rent",
                  category: "Housing",
                  amount: 15000,
                  type: "expense",
                  date: "2025-10-05",
                },
                {
                  description: "Groceries",
                  category: "Food",
                  amount: 5000,
                  type: "expense",
                  date: "2025-10-10",
                },
              ],
            };
          } catch (error) {
            return {
              total_income: 0,
              total_expense: 0,
              balance: 0,
              transactions: [],
            };
          }
        },

        async logWellness(data) {
          console.log("Logging wellness:", data);
          return { success: true };
        },
      };

      // ============ Component Rendering ============
      async function renderDashboard() {
        const today = new Date().toISOString().split("T")[0];
        const scheduleData = await API.getSchedule(today);
        const habits = await API.getHabits();

        return `
                  <div class="header">
                      <h1>üìä Dashboard</h1>
                  </div>

                  <div class="grid">
                      <div class="card">
                          <h2>üìÖ Today's Schedule</h2>
                          <p>${
                            scheduleData.events?.length || 0
                          } events scheduled</p>
                      </div>

                      <div class="card">
                          <h2>‚úÖ Habits</h2>
                          <p>${habits.length} habits tracked</p>
                      </div>

                      <div class="card">
                          <h2>üí∞ Finance</h2>
                          <p>View your spending insights</p>
                      </div>

                      <div class="card">
                          <h2>üßò Wellness</h2>
                          <p>Log your daily wellness check-in</p>
                      </div>
                  </div>

                  <div class="card" style="margin-top: 30px;">
                      <h2>Welcome to LifeOS!</h2>
                      <p style="color: #666; margin-top: 10px;">
                          Navigate using the sidebar to access different modules. Click on Schedule, Habits, Finance, or Wellness to get started.
                      </p>
                  </div>
              `;
      }

      async function renderSchedule() {
        const today = new Date().toISOString().split("T")[0];
        const scheduleData = await API.getSchedule(today);

        return `
                  <div class="header">
                      <h1>üìÖ Schedule</h1>
                  </div>

                  <!-- Natural Language Prompt Box -->
                  <div class="prompt-card">
                      <div class="prompt-header">
                          <h3>‚ú® Natural Language Scheduler</h3>
                          <p class="hint-text">
                              Examples: "Schedule team meeting tomorrow 3pm" ‚Ä¢ "Add dentist appointment next Tuesday 10am"
                          </p>
                      </div>

                      <div class="prompt-input-group">
                          <input
                              type="text"
                              id="schedulePrompt"
                              class="prompt-input"
                              placeholder="Type your command in plain English..."
                              onkeypress="handlePromptEnter(event)"
                          />
                          <button class="prompt-btn" onclick="processSchedulePrompt()">
                              <span id="btnText">Create Event</span>
                              <span id="btnLoader" style="display:none;">‚è≥ Processing...</span>
                          </button>
                      </div>

                      <!-- Response Area -->
                      <div id="promptResponse" class="prompt-response"></div>
                  </div>

                  <!-- Today's Events -->
                  <div class="card" style="margin-top: 20px;">
                      <h2>Today's Schedule</h2>
                      ${
                        scheduleData.events && scheduleData.events.length > 0
                          ? scheduleData.events
                              .map(
                                (event) => `
                              <div class="event-card">
                                  <span class="time">${formatTime(
                                    event.start_time
                                  )}</span>
                                  <div style="flex: 1;">
                                      <h3>${event.title}</h3>
                                      <p style="color: #666; font-size: 14px;">${
                                        event.description || ""
                                      }</p>
                                  </div>
                                  <button class="delete-btn" onclick="deleteEvent('${
                                    event.id
                                  }')">üóëÔ∏è</button>
                              </div>
                          `
                              )
                              .join(
                                '<hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">'
                              )
                          : '<p style="color: #999; text-align: center; padding: 40px;">No events scheduled today</p>'
                      }
                  </div>
              `;
      }

      async function renderHabits() {
        const habits = await API.getHabits();

        return `
                  <div class="header">
                      <h1>‚úÖ Daily Habits</h1>
                  </div>

                  <div class="grid">
                      ${
                        habits.length > 0
                          ? habits
                              .map(
                                (habit) => `
                          <div class="card habit-card">
                              <h3>${habit.name}</h3>
                              <p style="color: #666;">Target: ${
                                habit.target_count
                              }x/week</p>
                              <div class="streak">üî• ${
                                habit.streak || 0
                              } day streak</div>
                              <div class="habit-actions">
                                  <button class="btn-done" onclick="logHabit('${
                                    habit.id
                                  }', 'done')">‚úì Done</button>
                                  <button class="btn-skip" onclick="logHabit('${
                                    habit.id
                                  }', 'skip')">Skip</button>
                              </div>
                          </div>
                      `
                              )
                              .join("")
                          : '<p class="card">No habits configured yet</p>'
                      }
                  </div>
              `;
      }

      // Process Natural Language Schedule Prompt
      async function processSchedulePrompt() {
        const input = document.getElementById("schedulePrompt");
        const prompt = input.value.trim();

        if (!prompt) {
          showPromptResponse("error", "Please enter a command");
          return;
        }

        // Show loading state
        document.getElementById("btnText").style.display = "none";
        document.getElementById("btnLoader").style.display = "inline";
        document.querySelector(".prompt-btn").disabled = true;

        try {
          // Send to n8n webhook
          const response = await fetch(`${N8N_BASE_URL}/schedule/nl-parse`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              prompt: prompt,
              user_id: "user_001",
              timestamp: new Date().toISOString(),
            }),
          });

          const data = await response.json();

          if (data.success) {
            // Show success response
            showPromptResponse("success", "Event Created!", data.event);

            // Clear input
            input.value = "";

            // Refresh events list after 1 second
            setTimeout(() => router(), 1000);
          } else {
            showPromptResponse(
              "error",
              data.message || "Failed to create event"
            );
          }
        } catch (error) {
          console.error("Error:", error);
          showPromptResponse(
            "error",
            "Something went wrong. Please try again."
          );
        } finally {
          // Reset button state
          document.getElementById("btnText").style.display = "inline";
          document.getElementById("btnLoader").style.display = "none";
          document.querySelector(".prompt-btn").disabled = false;
        }
      }

      function handlePromptEnter(event) {
        if (event.key === "Enter") {
          processSchedulePrompt();
        }
      }

      function showPromptResponse(type, title, event = null) {
        const responseDiv = document.getElementById("promptResponse");
        const icon = type === "success" ? "‚úÖ" : "‚ùå";

        let content = `
                  <div class="response-content">
                      <div class="response-icon">${icon}</div>
                      <div class="response-text">
                          <h4>${title}</h4>
              `;

        if (event && type === "success") {
          content += `
                          <p><strong>Title:</strong> ${event.title}</p>
                          <p><strong>Time:</strong> ${formatDateTime(
                            event.start_time
                          )}</p>
                          ${
                            event.duration
                              ? `<p><strong>Duration:</strong> ${event.duration}</p>`
                              : ""
                          }
                          <small>Event added to your calendar</small>
                  `;
        } else if (type === "error") {
          content += `<p>${title}</p>`;
        }

        content += `
                      </div>
                  </div>
              `;

        responseDiv.innerHTML = content;
        responseDiv.classList.add("show");

        // Auto-hide after 5 seconds
        setTimeout(() => {
          responseDiv.classList.remove("show");
          setTimeout(() => (responseDiv.innerHTML = ""), 300);
        }, 5000);
      }

      async function deleteEvent(eventId) {
        if (!confirm("Delete this event?")) return;

        try {
          await fetch(`${N8N_BASE_URL}/schedule/delete`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ event_id: eventId }),
          });

          showNotification("Event deleted");
          router();
        } catch (error) {
          showNotification("Failed to delete event", "error");
        }
      }

      function formatDateTime(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString("en-IN", {
          weekday: "short",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      async function renderFinance() {
        const currentMonth = new Date().toISOString().slice(0, 7);
        const financeData = await API.getFinanceSummary(currentMonth);

        return `
                  <div class="header">
                      <h1>üí∞ Finance Manager</h1>
                  </div>

                  <!-- Summary Stats -->
                  <div class="finance-summary">
                      <div class="stat-card">
                          <h3>Total Income</h3>
                          <div class="amount">‚Çπ${
                            financeData.total_income?.toLocaleString("en-IN") ||
                            0
                          }</div>
                      </div>
                      <div class="stat-card" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);">
                          <h3>Total Expense</h3>
                          <div class="amount">‚Çπ${
                            financeData.total_expense?.toLocaleString(
                              "en-IN"
                            ) || 0
                          }</div>
                      </div>
                      <div class="stat-card" style="background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);">
                          <h3>Balance</h3>
                          <div class="amount">‚Çπ${
                            financeData.balance?.toLocaleString("en-IN") || 0
                          }</div>
                      </div>
                  </div>

                  <!-- 1. CSV Upload & Categorize -->
                  <div class="card">
                      <h2>üì§ CSV Ingest & Categorize</h2>
                      <p style="color: #666; margin-bottom: 20px;">Upload your bank statement CSV for automatic categorization and analysis</p>

                      <div class="file-upload-container" id="fileUploadZone">
                          <div class="upload-icon">üìÅ</div>
                          <h3>Drag & Drop CSV File</h3>
                          <p>or click to browse</p>
                          <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                          <button onclick="document.getElementById('csvFileInput').click()" style="margin-top: 15px;">
                              Choose File
                          </button>
                      </div>

                      <div id="uploadStatus" class="upload-status"></div>
                      <div id="categorizedData" class="categorized-preview"></div>
                  </div>

                  <!-- 2. Monthly Finance Summary -->
                  <div class="card">
                      <h2>üìä Monthly Finance Summary</h2>
                      <p style="color: #666; margin-bottom: 15px;">Automatically generated on 1st of each month</p>

                      <div class="summary-grid">
                          ${
                            financeData.categories
                              ? Object.entries(financeData.categories)
                                  .map(
                                    ([cat, amount]) => `
                              <div class="category-item">
                                  <div class="category-info">
                                      <span class="category-name">${cat}</span>
                                      <span class="category-percentage">${(
                                        (amount / financeData.total_expense) *
                                        100
                                      ).toFixed(1)}%</span>
                                  </div>
                                  <div class="category-bar">
                                      <div class="category-fill" style="width: ${
                                        (amount / financeData.total_expense) *
                                        100
                                      }%"></div>
                                  </div>
                                  <div class="category-amount">‚Çπ${amount.toLocaleString(
                                    "en-IN"
                                  )}</div>
                              </div>
                          `
                                  )
                                  .join("")
                              : '<p style="color: #999;">No data available for this month</p>'
                          }
                      </div>

                      ${
                        financeData.top_merchants
                          ? `
                          <div style="margin-top: 30px;">
                              <h3 style="margin-bottom: 15px;">Top Merchants</h3>
                              <div class="merchants-list">
                                  ${financeData.top_merchants
                                    .map(
                                      (merchant) => `
                                      <div class="merchant-item">
                                          <span class="merchant-name">${
                                            merchant.name
                                          }</span>
                                          <span class="merchant-amount">‚Çπ${merchant.amount.toLocaleString(
                                            "en-IN"
                                          )}</span>
                                      </div>
                                  `
                                    )
                                    .join("")}
                              </div>
                          </div>
                      `
                          : ""
                      }

                      ${
                        financeData.budget_variance
                          ? `
                          <div style="margin-top: 30px;">
                              <h3 style="margin-bottom: 15px;">Budget Variance</h3>
                              <div class="variance-indicator ${
                                financeData.budget_variance > 0
                                  ? "over-budget"
                                  : "under-budget"
                              }">
                                  ${
                                    financeData.budget_variance > 0
                                      ? "‚ö†Ô∏è Over Budget"
                                      : "‚úÖ Under Budget"
                                  }
                                  <span style="font-size: 20px; font-weight: bold; margin-left: 10px;">
                                      ‚Çπ${Math.abs(
                                        financeData.budget_variance
                                      ).toLocaleString("en-IN")}
                                  </span>
                              </div>
                          </div>
                      `
                          : ""
                      }
                  </div>

                  <!-- 3. Large Transaction Alerts -->
                  <div class="card">
                      <h2>üö® Large Transaction Alerts</h2>
                      <p style="color: #666; margin-bottom: 15px;">Automatic alerts for transactions above threshold</p>

                      <div class="alert-config">
                          <label>Alert Threshold (‚Çπ)</label>
                          <input type="number" id="alertThreshold" value="${
                            financeData.alert_threshold || 10000
                          }"
                                 onchange="updateAlertThreshold(this.value)"
                                 style="width: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                      </div>

                      <div id="largeTransactions" class="large-transactions-list">
                          ${
                            financeData.large_transactions &&
                            financeData.large_transactions.length > 0
                              ? financeData.large_transactions
                                  .map(
                                    (tx) => `
                                  <div class="alert-item">
                                      <div class="alert-icon">‚ö†Ô∏è</div>
                                      <div class="alert-details">
                                          <strong>${tx.description}</strong>
                                          <p style="font-size: 13px; color: #666; margin: 5px 0 0 0;">
                                              ${formatDate(tx.date)} ‚Ä¢ ${
                                      tx.category
                                    }
                                          </p>
                                      </div>
                                      <div class="alert-amount">
                                          ‚Çπ${tx.amount.toLocaleString("en-IN")}
                                      </div>
                                  </div>
                              `
                                  )
                                  .join("")
                              : '<p style="color: #999; text-align: center; padding: 30px;">No large transactions detected</p>'
                          }
                      </div>
                  </div>
              `;
      }


    async function renderWellness() {
        const trendData = await API.getWellnessTrend();
        
        return `
            <div class="header">
                <h1>üßò Wellness Dashboard</h1>
            </div>

            <!-- Weekly Wellness Trend -->
            <div class="card wellness-trend-section">
                <h2>üìà Weekly Wellness Trend</h2>
                <p style="color: #666; margin-bottom: 20px;">Your wellness insights from the last 4 weeks</p>

                <!-- Trend Summary Cards -->
                <div class="trend-summary">
                    <div class="trend-card">
                        <div class="trend-icon">üòä</div>
                        <div class="trend-info">
                            <div class="trend-label">Avg Mood</div>
                            <div class="trend-value">${trendData.avg_mood?.toFixed(1) || '-'}/5</div>
                            <div class="trend-change ${trendData.mood_change >= 0 ? 'positive' : 'negative'}">
                                ${trendData.mood_change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(trendData.mood_change || 0).toFixed(1)}%
                            </div>
                        </div>
                    </div>

                    <div class="trend-card">
                        <div class="trend-icon">üò¥</div>
                        <div class="trend-info">
                            <div class="trend-label">Avg Sleep</div>
                            <div class="trend-value">${trendData.avg_sleep?.toFixed(1) || '-'}h</div>
                            <div class="trend-change ${trendData.sleep_change >= 0 ? 'positive' : 'negative'}">
                                ${trendData.sleep_change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(trendData.sleep_change || 0).toFixed(1)}%
                            </div>
                        </div>
                    </div>

                    <div class="trend-card">
                        <div class="trend-icon">üö∂</div>
                        <div class="trend-info">
                            <div class="trend-label">Avg Steps</div>
                            <div class="trend-value">${(trendData.avg_steps || 0).toLocaleString('en-IN')}</div>
                            <div class="trend-change ${trendData.steps_change >= 0 ? 'positive' : 'negative'}">
                                ${trendData.steps_change >= 0 ? '‚Üó' : '‚Üò'} ${Math.abs(trendData.steps_change || 0).toFixed(1)}%
                            </div>
                        </div>
                    </div>

                    <div class="trend-card">
                        <div class="trend-icon">üìä</div>
                        <div class="trend-info">
                            <div class="trend-label">Check-ins</div>
                            <div class="trend-value">${trendData.checkin_count || 0}</div>
                            <div class="trend-label" style="font-size: 11px; margin-top: 4px;">Last 4 weeks</div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-wrapper">
                        <h3>Mood Trend</h3>
                        <canvas id="moodChart"></canvas>
                    </div>
                    <div class="chart-wrapper">
                        <h3>Sleep Pattern</h3>
                        <canvas id="sleepChart"></canvas>
                    </div>
                </div>

                <!-- AI Suggestions -->
                <div class="wellness-suggestions">
                    <h3>üí° Gentle Suggestions</h3>
                    <div class="suggestions-list">
                        ${trendData.suggestions && trendData.suggestions.length > 0 ? 
                            trendData.suggestions.map(suggestion => `
                                <div class="suggestion-item">
                                    <span class="suggestion-icon">${suggestion.icon}</span>
                                    <p>${suggestion.text}</p>
                                </div>
                            `).join('') 
                        : '<p style="color: #999;">Keep logging your wellness to get personalized insights!</p>'}
                    </div>
                </div>

                <!-- Link to Google Sheet -->
                ${trendData.sheet_link ? `
                    <div style="text-align: center; margin-top: 20px;">
                        <a href="${trendData.sheet_link}" target="_blank" class="sheet-link">
                            üìä View Detailed Report in Google Sheets
                        </a>
                    </div>
                ` : ''}
            </div>

            <!-- Daily Check-in Form -->
            <div class="wellness-form">
                <h2>‚úçÔ∏è Today's Check-in</h2>
                <p style="color: #666; margin-bottom: 20px;">How are you feeling today?</p>

                <div class="form-group">
                    <label>Mood</label>
                    <div class="mood-selector">
                        <button class="mood-btn" onclick="selectMood(1, event)">üò¢</button>
                        <button class="mood-btn" onclick="selectMood(2, event)">üòï</button>
                        <button class="mood-btn" onclick="selectMood(3, event)">üòê</button>
                        <button class="mood-btn" onclick="selectMood(4, event)">üôÇ</button>
                        <button class="mood-btn" onclick="selectMood(5, event)">üòÑ</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Hours of sleep</label>
                    <input type="number" id="sleepHours" min="0" max="24" step="0.5" placeholder="e.g., 7.5">
                </div>

                <div class="form-group">
                    <label>Steps today</label>
                    <input type="number" id="stepsCount" placeholder="e.g., 8000">
                </div>

                <div class="form-group">
                    <label>Notes (optional)</label>
                    <textarea id="wellnessNotes" rows="3" placeholder="Any thoughts or observations..."></textarea>
                </div>

                <button onclick="submitWellness()">Submit Check-in</button>
            </div>
        `;
    }



      // Chat Functions
      async function sendChatMessage() {
        const input = document.getElementById("chatInput");
        const message = input.value.trim();

        if (!message) return;

        // Add user message to chat
        addMessageToChat(message, "user");
        input.value = "";

        // Show typing indicator
        showTypingIndicator();

        try {
          // Send to n8n for natural language processing
          const response = await fetch(`${N8N_BASE_URL}/schedule/chat`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              message: message,
              timestamp: new Date().toISOString(),
            }),
          });

          const data = await response.json();

          // Remove typing indicator
          removeTypingIndicator();

          // Handle response
          if (data.action === "create_event") {
            displayEventConfirmation(data);
          } else if (data.action === "list_events") {
            displayEventsList(data);
          } else if (data.action === "delete_event") {
            displayDeleteConfirmation(data);
          } else {
            addMessageToChat(
              data.message || "Event processed successfully!",
              "bot"
            );
          }

          // Refresh events list
          setTimeout(() => router(), 1000);
        } catch (error) {
          removeTypingIndicator();
          addMessageToChat(
            "Sorry, I had trouble processing that. Please try again.",
            "bot"
          );
          console.error("Chat error:", error);
        }
      }

      function handleChatEnter(event) {
        if (event.key === "Enter") {
          sendChatMessage();
        }
      }

      function addMessageToChat(message, type) {
        const chatMessages = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `${type}-message`;

        messageDiv.innerHTML = `
                  <div class="message-bubble ${type}">
                      ${message}
                  </div>
              `;

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function showTypingIndicator() {
        const chatMessages = document.getElementById("chatMessages");
        const typingDiv = document.createElement("div");
        typingDiv.className = "bot-message";
        typingDiv.id = "typingIndicator";
        typingDiv.innerHTML = `
                  <div class="message-bubble bot">
                      <div class="typing-indicator">
                          <span></span>
                          <span></span>
                          <span></span>
                      </div>
                  </div>
              `;
        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      function removeTypingIndicator() {
        const typing = document.getElementById("typingIndicator");
        if (typing) typing.remove();
      }

      function displayEventConfirmation(data) {
        const eventDetails = `
                  <div class="event-suggestion">
                      <strong>üìÖ Event Created!</strong>
                      <div><strong>Title:</strong> ${data.event.title}</div>
                      <div><strong>Time:</strong> ${formatDateTime(
                        data.event.start_time
                      )}</div>
                      ${
                        data.event.duration
                          ? `<div><strong>Duration:</strong> ${data.event.duration}</div>`
                          : ""
                      }
                  </div>
              `;
        addMessageToChat(eventDetails, "bot");
      }

      function displayEventsList(data) {
        if (data.events && data.events.length > 0) {
          const eventsList = `
                      <div>Found ${data.events.length} event(s):</div>
                      ${data.events
                        .map(
                          (event) => `
                          <div class="event-suggestion">
                              <strong>${event.title}</strong>
                              <div>${formatDateTime(event.start_time)}</div>
                          </div>
                      `
                        )
                        .join("")}
                  `;
          addMessageToChat(eventsList, "bot");
        } else {
          addMessageToChat("No events found for that time period.", "bot");
        }
      }

      function displayDeleteConfirmation(data) {
        addMessageToChat(
          `Event "${data.event_title}" has been deleted.`,
          "bot"
        );
      }

      function formatDateTime(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString("en-IN", {
          weekday: "short",
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      // ============ HASH-BASED ROUTER ============
      const routes = {
        "": renderDashboard,
        schedule: renderSchedule,
        habits: renderHabits,
        finance: renderFinance,
        wellness: renderWellness,
      };

      async function router() {
        // Get hash without the # symbol
        const hash = window.location.hash.slice(1) || "/";
        const route = hash.replace("/", "");

        // Update active link
        document.querySelectorAll(".sidebar a").forEach((link) => {
          link.classList.remove("active");
          if (link.getAttribute("href") === "#" + hash) {
            link.classList.add("active");
          }
        });

        const app = document.getElementById("app");
        app.innerHTML = '<div class="loading">Loading...</div>';

        const renderFunction = routes[route] || routes[""];

        try {
          app.innerHTML = await renderFunction();
        } catch (error) {
          console.error("Routing error:", error);
          app.innerHTML = '<div class="card"><h1>Error loading page</h1></div>';
        }
      }

      // Listen to hash changes
      window.addEventListener("hashchange", router);

      // ============ Event Handlers ============
      function openEventModal() {
        document.getElementById("eventModal").classList.add("active");
      }

      function closeModal() {
        document.getElementById("eventModal").classList.remove("active");
      }

      async function createEvent() {
        const title = document.getElementById("eventTitle").value;
        const time = document.getElementById("eventTime").value;
        const description = document.getElementById("eventDescription").value;

        if (!title || !time) {
          showNotification("Please fill required fields", "error");
          return;
        }

        await API.createEvent({ title, time, description });

        // Clear form
        document.getElementById("eventTitle").value = "";
        document.getElementById("eventTime").value = "";
        document.getElementById("eventDescription").value = "";

        closeModal();
        showNotification("Event created successfully!");
        router();
      }

      async function logHabit(habitId, status) {
        await API.logHabit(habitId, status);
        showNotification(`Habit ${status}!`);
        router();
      }

// Wellness Functions
let selectedMood = null;
function selectMood(mood, event) {
  selectedMood = mood;
  document
    .querySelectorAll(".mood-btn")
    .forEach((btn) => btn.classList.remove("selected"));
  event.target.classList.add("selected");
}
async function submitWellness() {
  const sleep = document.getElementById("sleepHours")?.value;
  const steps = document.getElementById("stepsCount")?.value;
  const notes = document.getElementById("wellnessNotes")?.value;
  if (!selectedMood) {
    showNotification("Please select your mood", "error");
    return;
  }
  await API.logWellness({
    mood: selectedMood,
    sleep: parseFloat(sleep) || 0,
    steps: parseInt(steps) || 0,
    notes: notes,
    timestamp: new Date().toISOString(),
  });
  showNotification("Wellness check-in saved!");
  setTimeout(() => (window.location.hash = "#/"), 1000);
}

      // Utility Functions
      function showNotification(message, type = "success") {
        const notification = document.createElement("div");
        notification.className = "notification";
        notification.textContent = message;
        if (type === "error") notification.style.background = "#ff6b6b";

        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
      }

      function formatTime(timeString) {
        if (!timeString) return "";
        const date = new Date(timeString);
        return date.toLocaleTimeString("en-IN", {
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      function formatDate(dateString) {
        if (!dateString) return "";
        const date = new Date(dateString);
        return date.toLocaleDateString("en-IN", {
          day: "numeric",
          month: "short",
        });
      }

      // Initialize on load
      document.addEventListener("DOMContentLoaded", () => {
        // Set default hash if empty
        if (!window.location.hash) {
          window.location.hash = "#/";
        }
        router();
      });
    </script>
  </body>
</html>
